<!doctype html>
<html>
  <head>
    <title>Clementine Channel</title>
    <script type="text/javascript" src="/_ah/channel/jsapi"></script>
  </head>
  <body>
  <script type="text/javascript">
    function log(msg) {
      window.console.log(msg);
    }

    function messageReceived(msg) {
      alert(msg);
    }

    function controlMessageReceived(msg) {
      confirm(msg);
    }

    var id = '{{ id }}';
    controlMessageReceived(id);  // Pass our id back to clementine.
    var channel = new goog.appengine.Channel('{{ token }}');
    var socket = channel.open();
    socket.onopen = function() {
      log('open');
    };
    socket.onmessage = function(message) {
      messageReceived(message.data);
    };
    socket.onerror = function() {
      log('error');
    };
    socket.onclose = function() {
      log('close');
    };
  </script>
  </body>
</html>
